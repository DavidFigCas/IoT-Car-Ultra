[{"id":"50896b44.fe0db4","type":"tab","label":"Radar","disabled":false,"info":""},{"id":"6e574eb3.4d449","type":"tab","label":"Dirección","disabled":false,"info":""},{"id":"ffb2504d.e8d94","type":"tab","label":"Sistema","disabled":false,"info":""},{"id":"4bb65ed0.821b1","type":"tab","label":"Motores","disabled":false,"info":""},{"id":"8ba99e86.6869e","type":"tab","label":"Configuraciones","disabled":false,"info":""},{"id":"d4010628.de4e88","type":"tab","label":"Interfaz Teléfono","disabled":false,"info":""},{"id":"8d66ddb9.1d7e","type":"tab","label":"Cámara","disabled":false,"info":""},{"id":"44bfb592.46188c","type":"ui_tab","z":"","name":"Autónomo","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"5276cd55.81f1dc","type":"ui_group","z":"","name":"Setup","tab":"44bfb592.46188c","order":1,"disp":true,"width":"6","collapse":false},{"id":"d44159a6.891fb8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"IoT Car","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"8e519d78.640be","type":"mqtt-broker","z":"","name":"","broker":"web.inventoteca.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cc6c21f5.20601","type":"ui_group","z":"","name":"WiFi","tab":"cc970ea.0f13df","order":2,"disp":true,"width":"6","collapse":true},{"id":"cc970ea.0f13df","type":"ui_tab","z":"","name":"Sistema","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"d8e7c0bd.e7edb","type":"ui_group","z":"","name":"Botones","tab":"e47e2d7f.ea2e5","order":2,"disp":false,"width":"6","collapse":false},{"id":"bf30e811.8206f8","type":"ui_group","z":"","name":"Apagar","tab":"cc970ea.0f13df","disp":true,"width":"6","collapse":false},{"id":"d6ff8b79.b23718","type":"ui_group","z":"","name":"Cámara","tab":"e47e2d7f.ea2e5","order":1,"disp":false,"width":"6","collapse":false},{"id":"e47e2d7f.ea2e5","type":"ui_tab","z":"","name":"Control","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"192caa48.1b50d6","type":"ui_group","z":"","name":"Motores","tab":"cc970ea.0f13df","disp":true,"width":"6","collapse":false},{"id":"adab6c01.57e17","type":"ui_group","z":"","name":"Autónomo","tab":"e47e2d7f.ea2e5","disp":true,"width":"6","collapse":false},{"id":"cc1490de.c0d77","type":"rpi-srf","z":"50896b44.fe0db4","name":"Frente","topic":"SRF","pulse":"0.06","pins":"21,22","x":390,"y":240,"wires":[["eb8cc81c.cd0038"]]},{"id":"26399dea.e1c72a","type":"pi-gpiod out","z":"50896b44.fe0db4","name":"Sensor","host":"localhost","port":8888,"pin":"10","set":"","level":"0","out":"ser","sermin":"500","sermax":"2500","x":1240,"y":520,"wires":[]},{"id":"328fa9c9.56fa86","type":"ui_slider","z":"50896b44.fe0db4","name":"","label":"Sensor","tooltip":"","group":"5276cd55.81f1dc","order":6,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":"75","max":"20","step":"0.5","x":880,"y":480,"wires":[["26399dea.e1c72a"]]},{"id":"6c671ebf.20bfb8","type":"inject","z":"ffb2504d.e8d94","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":100,"wires":[["753503e.0cfa1fc"]]},{"id":"753503e.0cfa1fc","type":"exec","z":"ffb2504d.e8d94","command":"sudo pigpiod","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":290,"y":100,"wires":[["ff380ffc.1e3db8"],["ff380ffc.1e3db8"],["ff380ffc.1e3db8"]]},{"id":"ff380ffc.1e3db8","type":"debug","z":"ffb2504d.e8d94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":510,"y":100,"wires":[]},{"id":"1c97792b.dc992f","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":835.0000038146973,"y":65.00000762939453,"wires":[["ce85ac1a.5195b"]]},{"id":"983d2256.d9a3d","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":835.0000038146973,"y":105.00000762939453,"wires":[["ce85ac1a.5195b"]]},{"id":"df7119da.7b51e8","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":855.0000038146973,"y":445.00000762939453,"wires":[["3963a3ef.28a084"]]},{"id":"cf405d2b.beda88","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":855.0000038146973,"y":485.00000762939453,"wires":[["3963a3ef.28a084"]]},{"id":"3963a3ef.28a084","type":"pi-gpiod out","z":"4bb65ed0.821b1","name":"Izquierda-B","host":"localhost","port":8888,"pin":"22","set":"","level":"0","out":"pwm","sermin":"1000","sermax":"2000","x":995.0000038146973,"y":305.00000762939453,"wires":[]},{"id":"ce85ac1a.5195b","type":"pi-gpiod out","z":"4bb65ed0.821b1","name":"Izquierda-A","host":"localhost","port":8888,"pin":"23","set":"","level":"0","out":"pwm","sermin":"1000","sermax":"2000","x":995.0000038146973,"y":165.00000762939453,"wires":[]},{"id":"b43b35b9.387b","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":875.0000038146973,"y":585.0000076293945,"wires":[["d66fa798.05bba8"]]},{"id":"1e3ac8d2.ca35cf","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":875.0000038146973,"y":625.0000076293945,"wires":[["d66fa798.05bba8"]]},{"id":"fe0f1f43.2f707","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":915.0000038146973,"y":985.0000076293945,"wires":[["fd9ba81d.166b7"]]},{"id":"483b1fbf.f8cc3","type":"inject","z":"4bb65ed0.821b1","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":915.0000038146973,"y":1025.0000076293945,"wires":[["fd9ba81d.166b7"]]},{"id":"fd9ba81d.166b7","type":"pi-gpiod out","z":"4bb65ed0.821b1","name":"Derecha-B","host":"localhost","port":8888,"pin":"18","set":"","level":"0","out":"pwm","sermin":"1000","sermax":"2000","x":1035.0000038146973,"y":845.0000076293945,"wires":[]},{"id":"d66fa798.05bba8","type":"pi-gpiod out","z":"4bb65ed0.821b1","name":"Derecha-A","host":"localhost","port":8888,"pin":"17","set":"","level":"0","out":"pwm","sermin":"1000","sermax":"2000","x":1035.0000038146973,"y":705.0000076293945,"wires":[]},{"id":"5a4ed3d9.70c23c","type":"debug","z":"50896b44.fe0db4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1230,"y":420,"wires":[]},{"id":"37e49056.862ea","type":"inject","z":"50896b44.fe0db4","name":"","topic":"","payload":"","payloadType":"date","repeat":"0.1","crontab":"","once":false,"onceDelay":0.1,"x":430,"y":420,"wires":[["9c631bb.f4f2ee8"]]},{"id":"f460df40.d4661","type":"function","z":"50896b44.fe0db4","name":"barrido-sensor","func":"var pos = flow.get('pos');\nvar subida = flow.get('subida');\nvar dist = flow.get('dist')\n//var posiciones = flow.get();\n\nif(subida === true)\n{\n  pos = pos +5;\n  if(pos >= 75)\n  {\n      flow.set('subida',false);\n      pos = 75;\n  }\n}\nelse\n{\n  pos = pos -5;\n  if(pos <= 20)\n  {\n      flow.set('subida',true);\n      pos = 20;\n  }\n}\n\n\nvar msg2 = {payload: pos}\n\nmsg = {topic: pos.toString()};\nmsg = {payload: dist};\nflow.set('pos',pos);\nflow.set('posAtr',pos + 75);\n\n\nreturn [msg,msg2];","outputs":2,"noerr":0,"x":780,"y":420,"wires":[[],["5a4ed3d9.70c23c","26399dea.e1c72a","e9e2b82f.889b28"]]},{"id":"5f8f36c.e5b60c8","type":"exec","z":"ffb2504d.e8d94","command":"docker container restart iot-wifi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":380,"y":200,"wires":[["db522b40.3b85d8"],["db522b40.3b85d8"],["db522b40.3b85d8"]]},{"id":"35ed6bcc.15c984","type":"inject","z":"ffb2504d.e8d94","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":120,"y":200,"wires":[["5f8f36c.e5b60c8"]]},{"id":"db522b40.3b85d8","type":"debug","z":"ffb2504d.e8d94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":200,"wires":[]},{"id":"9c631bb.f4f2ee8","type":"switch","z":"50896b44.fe0db4","name":"radar?","property":"radar","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":590,"y":420,"wires":[["f460df40.d4661"]]},{"id":"59e45e55.e83ef","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"dist","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":240,"wires":[["325f77f2.39dfa8"]]},{"id":"325f77f2.39dfa8","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"pos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":240,"wires":[["283ccff0.05a1b","7ba7936f.0cc30c","c57c18f1.12aaa8"]]},{"id":"eb8cc81c.cd0038","type":"smooth","z":"50896b44.fe0db4","name":"","property":"payload","action":"mean","count":"3","round":"0","mult":"single","reduce":true,"x":540,"y":240,"wires":[["59e45e55.e83ef","a1eb59de.b8ad88"]]},{"id":"561dfd0a.3d3a84","type":"ui_chart","z":"50896b44.fe0db4","name":"","group":"5276cd55.81f1dc","order":5,"width":0,"height":0,"label":"Radar","chartType":"radar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"150","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1210,"y":260,"wires":[[]]},{"id":"b7675d22.d4c27","type":"inject","z":"ffb2504d.e8d94","name":"","topic":"","payload":"sudo reboot","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":320,"wires":[["46eee955.d07fd8"]]},{"id":"46eee955.d07fd8","type":"exec","z":"ffb2504d.e8d94","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":420,"y":320,"wires":[[],[],[]]},{"id":"ef7264da.76fa78","type":"inject","z":"50896b44.fe0db4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":190,"y":580,"wires":[["b0b53cbf.f8eac"]]},{"id":"b0b53cbf.f8eac","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"pos","pt":"flow","to":"20","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":580,"wires":[[]]},{"id":"46379da1.a45524","type":"inject","z":"ffb2504d.e8d94","name":"","topic":"","payload":"sudo halt","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":400,"wires":[["f267a421.891d58"]]},{"id":"f267a421.891d58","type":"exec","z":"ffb2504d.e8d94","command":"sudo halt","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":400,"y":400,"wires":[[],[],[]]},{"id":"283ccff0.05a1b","type":"function","z":"50896b44.fe0db4","name":"direccion-automatica","func":"var pos = msg.topic;\nvar dist = msg.payload;\nvar posiciones = global.get('posiciones')||new Array(10);\nvar max;\nvar sector;\nvar distMin = global.get('distMin')||100;  // Distancia minima\nvar distProm = global.get('distProm')||distMin;\n\npos = (pos/5)-4;\n \nposiciones[pos] = dist;\n\nmax = Math.max.apply(null,posiciones);\nsector = posiciones.indexOf(max);\n\nif((max < distMin) || (distProm < distMin))\n{\n    global.set('reversa',true);\n}\nelse\n{\n   global.set('reversa',false); \n}\n\nglobal.set('posiciones',posiciones);\nglobal.set('max',max);\nglobal.set('sector',sector);\n\nmsg = {payload:sector};\nvar msg2 = {payload:max};\n\nreturn [msg,msg2];","outputs":2,"noerr":0,"x":1080,"y":140,"wires":[["d6e21cb3.71a82"],[]]},{"id":"d2b262e.0b15da","type":"function","z":"4bb65ed0.821b1","name":"motores","func":"var reversa = global.get('reversa');\nvar radar = global.get('radar');\nvar auto = global.get('auto');\nvar motDA, motDB, motIA, motIB;\nvar velMax = global.get('velMax')||100;\nvar pwmD = velMax;\nvar pwmI = velMax;\nvar sector = global.get('sector')||5;\nvar motores = global.get('motores')||false;\n\n\n\nif(reversa === false)\n{\n    if((sector < 4)) // Esta libre la izquierda\n    {\n       pwmI = velMax;\n       pwmD = velMax - (Math.abs((sector - 4)*10));\n    }\n    else if(sector > 5) // esta libre la derecha\n    {\n        pwmI = velMax - (Math.abs((5 - sector)*10));\n        pwmD = velMax;\n    }\n    else\n    {\n        pwmI= velMax;\n        pwmD = velMax;\n    }\n}\nelse\n{\n   if((sector < 4)) // Esta libre la izquierda\n    {\n       pwmI = velMax - (Math.abs((sector - 4)*10));\n       pwmD = velMax;\n    }\n    else if(sector > 5) // esta libre la derecha\n    {\n        pwmI = velMax;\n        pwmD = velMax - (Math.abs((5 - sector)*10));\n    }\n    else\n    {\n        pwmI= velMax;\n        pwmD = velMax;\n    } \n}\n\nif((reversa === false) && ((auto === true) || motores === true)) // No hay reversa\n{\n    motDA = {payload:0};\n    motDB = {payload:pwmD};\n    motIA = {payload:0};\n    motIB = {payload:pwmI};\n}\nelse if((reversa === true) && ((auto === true) || (motores === true)))\n{\n    motDA = {payload:pwmD};\n    motDB = {payload:0};\n    motIA = {payload:pwmI};\n    motIB = {payload:0};\n}\nelse\n{\n    motDA = {payload:0};\n    motDB = {payload:0};\n    motIA = {payload:0};\n    motIB = {payload:0};\n}\n\nreturn [motIA,motIB,motDA,motDB];","outputs":4,"noerr":0,"x":325.00000381469727,"y":545.0000076293945,"wires":[["63f56713.a60938"],["6403a4c4.cce28c"],["ab82ec5a.970cd"],["b897b495.593c08"]]},{"id":"1ebd748.7289e8c","type":"link out","z":"50896b44.fe0db4","name":"distancia-radar","links":["d2457060.6ddad"],"x":1575,"y":460,"wires":[]},{"id":"d2457060.6ddad","type":"link in","z":"4bb65ed0.821b1","name":"motores-radar","links":["1ebd748.7289e8c","2a2343f1.20400c"],"x":200.00000381469727,"y":545.0000076293945,"wires":[["d2b262e.0b15da"]]},{"id":"ddf09d98.eef4d","type":"ui_slider","z":"8ba99e86.6869e","name":"","label":"Velocidad Máxima","tooltip":"","group":"5276cd55.81f1dc","order":8,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":"35","max":"100","step":1,"x":410,"y":140,"wires":[["26dc55b.7b5c5aa"]]},{"id":"26dc55b.7b5c5aa","type":"change","z":"8ba99e86.6869e","name":"","rules":[{"t":"set","p":"velMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":140,"wires":[[]]},{"id":"d01a9bf6.a88ef8","type":"ui_slider","z":"8ba99e86.6869e","name":"","label":"Distancia Minima","tooltip":"","group":"5276cd55.81f1dc","order":2,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":"5","max":"100","step":1,"x":410,"y":200,"wires":[["c17621f8.e9233"]]},{"id":"c17621f8.e9233","type":"change","z":"8ba99e86.6869e","name":"","rules":[{"t":"set","p":"distMin","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":200,"wires":[[]]},{"id":"22cfa0d8.4ecd5","type":"ui_gauge","z":"50896b44.fe0db4","name":"","group":"5276cd55.81f1dc","order":1,"width":0,"height":0,"gtype":"gage","title":"Distancia para colisión","label":"cm","format":"{{value}}","min":0,"max":"100","colors":["#b50000","#e6e600","#39ca38"],"seg1":"","seg2":"","x":1180,"y":300,"wires":[]},{"id":"a1eb59de.b8ad88","type":"smooth","z":"50896b44.fe0db4","name":"","property":"payload","action":"min","count":"6","round":"0","mult":"single","reduce":true,"x":720,"y":320,"wires":[["dafd9c94.13046","da930741.a89078"]]},{"id":"dafd9c94.13046","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"distProm","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":360,"wires":[[]]},{"id":"de4bed7.ee7c31","type":"inject","z":"8ba99e86.6869e","name":"","topic":"","payload":"velMax","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":180,"y":140,"wires":[["ddf09d98.eef4d"]]},{"id":"3a96b2be.7701ce","type":"inject","z":"8ba99e86.6869e","name":"","topic":"","payload":"distMin","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":180,"y":200,"wires":[["d01a9bf6.a88ef8"]]},{"id":"bbb4c4f6.6836a8","type":"comment","z":"8ba99e86.6869e","name":"Configuración WiFi","info":"","x":350,"y":500,"wires":[]},{"id":"50c5cfd0.1f7ab","type":"ui_text_input","z":"8ba99e86.6869e","name":"","label":"SSID","tooltip":"","group":"cc6c21f5.20601","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"","x":395,"y":563,"wires":[["568bf297.db626c"]]},{"id":"1361b13b.edabaf","type":"inject","z":"8ba99e86.6869e","name":"","topic":"","payload":"ssid","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"70","x":255,"y":563,"wires":[["50c5cfd0.1f7ab"]]},{"id":"568bf297.db626c","type":"change","z":"8ba99e86.6869e","name":"","rules":[{"t":"set","p":"ssid","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":565,"y":563,"wires":[[]]},{"id":"9f933db5.5326b","type":"ui_text_input","z":"8ba99e86.6869e","name":"","label":"KEY","tooltip":"","group":"cc6c21f5.20601","order":2,"width":0,"height":0,"passthru":true,"mode":"password","delay":"0","topic":"","x":394,"y":620,"wires":[["cad0cad5.a8f498"]]},{"id":"3ffa45ee.85e27a","type":"inject","z":"8ba99e86.6869e","name":"","topic":"","payload":"psk","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"70","x":254,"y":620,"wires":[["9f933db5.5326b"]]},{"id":"cad0cad5.a8f498","type":"change","z":"8ba99e86.6869e","name":"","rules":[{"t":"set","p":"psk","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":564,"y":620,"wires":[[]]},{"id":"1191c7ca.64d2d8","type":"ui_button","z":"8ba99e86.6869e","name":"","group":"cc6c21f5.20601","order":3,"width":0,"height":0,"passthru":false,"label":"Agregar WiFi","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"Nueva Red","x":232,"y":686,"wires":[["902dbe21.b6107"]]},{"id":"911f2695.2b6d28","type":"link out","z":"8ba99e86.6869e","name":"ui-agregar-wifi","links":["694e0bf2.f5b284"],"x":637,"y":686,"wires":[]},{"id":"902dbe21.b6107","type":"ui_toast","z":"8ba99e86.6869e","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"Agregar","cancel":"Cancelar","topic":"¿Seguro que deseas agregar una nueva red?","name":"","x":432,"y":686,"wires":[["911f2695.2b6d28"]]},{"id":"693874d0.aca13c","type":"link in","z":"8ba99e86.6869e","name":"ui-ssid","links":["7ba31f8c.a2ff2"],"x":180,"y":503,"wires":[["50c5cfd0.1f7ab"]]},{"id":"4283e976.b40da8","type":"exec","z":"ffb2504d.e8d94","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"conectar ssid","x":470,"y":560,"wires":[[],[],[]]},{"id":"d2e22ace.d7e1f8","type":"function","z":"ffb2504d.e8d94","name":"fromato-ssid+psk","func":"//curl -w \"\\n\" -d '{\"ssid\":\"Inventoteca_2G\", \"psk\":\"science_7425\"}' \\      -H \"Content-Type: application/json\" \\      -X POST localhost:8080/connect\nvar ssid = global.get('ssid');\nvar psk = global.get('psk');\n\n\nvar formato = 'curl -w';\nformato += '\" \\n \"';\nformato += ' -d ';\nformato += \"'\";\nformato += '{\"ssid\":'\nformato += '\"';\nformato += ssid;\nformato += '\"';\nformato += ', ';\nformato += '\"psk\":';\nformato += '\"'\nformato += psk\nformato += '\"'\nformato += \"}\";\nformato += \"'\";\nformato += '\"\\\"';\nformato += '-H ';\nformato += '\"';\nformato += \"Content-Type: application/json\";\nformato += '\"';\nformato += '\"\\\"';\nformato +=  '-X ' \nformato += \"POST localhost:8080/connect\";\nmsg = {payload:formato};\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":560,"wires":[["4283e976.b40da8"]]},{"id":"694e0bf2.f5b284","type":"link in","z":"ffb2504d.e8d94","name":"sistema-agregar-wifi","links":["911f2695.2b6d28"],"x":160,"y":560,"wires":[["d2e22ace.d7e1f8"]]},{"id":"409ee3f7.249f1c","type":"comment","z":"ffb2504d.e8d94","name":"Agregar WiFi","info":"","x":150,"y":500,"wires":[]},{"id":"57aa6d76.1f7e64","type":"exec","z":"ffb2504d.e8d94","command":"ifconfig wlan0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":394.50000381469727,"y":714.0000114440918,"wires":[["9e4b3270.2b91f"],[],[]]},{"id":"2b01ae19.9c9702","type":"link out","z":"ffb2504d.e8d94","name":"sistema-respuesta-ip","links":["eb46a588.815758","3a9ae30.cf75d1e"],"x":889.5000038146973,"y":734.0000114440918,"wires":[]},{"id":"92b4513d.73eb4","type":"comment","z":"ffb2504d.e8d94","name":"IP","info":"","x":130,"y":640,"wires":[]},{"id":"3b1bd91d.f7ac96","type":"switch","z":"ffb2504d.e8d94","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"inet","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":664.5000038146973,"y":694.0000114440918,"wires":[["9fef3b1e.e06768"]]},{"id":"9e4b3270.2b91f","type":"split","z":"ffb2504d.e8d94","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":544.5000038146973,"y":694.0000114440918,"wires":[["3b1bd91d.f7ac96"]]},{"id":"8ee42a57.da4328","type":"debug","z":"ffb2504d.e8d94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":964.5000038146973,"y":674.0000114440918,"wires":[]},{"id":"9fef3b1e.e06768","type":"switch","z":"ffb2504d.e8d94","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"inet6","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":784.5000038146973,"y":694.0000114440918,"wires":[[],["8ee42a57.da4328","2b01ae19.9c9702"]]},{"id":"5ac3bc98.368734","type":"exec","z":"ffb2504d.e8d94","command":"iwconfig wlan0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":394.50000381469727,"y":814.0000114440918,"wires":[["2549dc62.8acfd4"],["2549dc62.8acfd4"],["2549dc62.8acfd4"]]},{"id":"a5dddec2.3c99b","type":"debug","z":"ffb2504d.e8d94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1084.5000038146973,"y":794.0000114440918,"wires":[]},{"id":"b04c049e.f3e6c8","type":"switch","z":"ffb2504d.e8d94","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"ESSID:","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":684.5000038146973,"y":814.0000114440918,"wires":[["22e42170.a0820e"]]},{"id":"2549dc62.8acfd4","type":"split","z":"ffb2504d.e8d94","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":564.5000038146973,"y":814.0000114440918,"wires":[["b04c049e.f3e6c8"]]},{"id":"22e42170.a0820e","type":"split","z":"ffb2504d.e8d94","name":"","splt":":","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":824.5000038146973,"y":814.0000114440918,"wires":[["9f483132.2c579"]]},{"id":"9f483132.2c579","type":"switch","z":"ffb2504d.e8d94","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"ESSID","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":944.5000038146973,"y":814.0000114440918,"wires":[["a5dddec2.3c99b"],["7ba31f8c.a2ff2"]]},{"id":"7ba31f8c.a2ff2","type":"link out","z":"ffb2504d.e8d94","name":"sistema-ssid","links":["693874d0.aca13c"],"x":1069.5000038146973,"y":834.0000114440918,"wires":[]},{"id":"30e1de92.4ed762","type":"ui_text","z":"8ba99e86.6869e","group":"cc6c21f5.20601","order":4,"width":0,"height":0,"name":"","label":"IP","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":760,"wires":[]},{"id":"3a9ae30.cf75d1e","type":"link in","z":"8ba99e86.6869e","name":"ui-ip","links":["2b01ae19.9c9702"],"x":175,"y":760,"wires":[["30e1de92.4ed762"]]},{"id":"e108bb8a.f2bd38","type":"inject","z":"ffb2504d.e8d94","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":"60","x":147.50000381469727,"y":775.0000114440918,"wires":[["57aa6d76.1f7e64","5ac3bc98.368734"]]},{"id":"c228bcf1.7f791","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"Adelante","order":3,"width":"2","height":"1","format":"<div class=\"momentaryad vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#c0392b\"> \n    <i class=\"fa fa-arrow-up fa-2x\"></i>\n</md-button>\n</center>\n</div>\n<script>\n(function($scope) {\n$('.momentaryad').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryad').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":320,"wires":[["e7972d49.1999a","81fbf784.a31988","e54c41f4.4739"]]},{"id":"c42d9ec9.10da","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"Derecha","order":7,"width":"2","height":"1","format":"<div class=\"momentaryder vibrate filled touched bigfont rounded\" style=\"background-color:#009999\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#009999\">  \n    <i class=\"fa fa-camera fa-2x\" aria-hidden=\"true\"></i>\n    <i class=\"fa fa-arrow-right fa-2x\" aria-hidden=\"true\"></i>\n<script>\n(function($scope) {\n$('.momentaryder').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryder').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n</md-button>\n</center>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":500,"wires":[[]]},{"id":"b339036a.c50bc","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"arriba der","order":4,"width":"2","height":"1","format":"<div class=\"momentaryarder vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#c0392b\">  \n    <i class=\"fa fa-reply fa-2x fa-flip-horizontal\"></i>\n</md-button> \n</center>\n</div>\n<script>\n(function($scope) {\n$('.momentaryarder').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryarder').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":220,"wires":[["e7972d49.1999a","e982dd44.3aa8e","e54c41f4.4739"]]},{"id":"1d4ea6d5.96b2f9","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"Izquierda","order":5,"width":"2","height":"1","format":"<div class=\"momentaryiz vibrate filled touched bigfont rounded\" style=\"background-color:#009999\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#009999\"> \n    <i class=\"fa fa-arrow-left fa-2x\" aria-hidden=\"true\"></i>\n    <i class=\"fa fa-camera fa-2x\" aria-hidden=\"true\"></i>\n</md-button>\n</center>\n</div>\n<script>\n(function($scope) {\n$('.momentaryiz').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryiz').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n\n","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":240,"y":460,"wires":[[]]},{"id":"96a3e472.1189f8","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"Centro","order":6,"width":"2","height":"1","format":"   \n<div class=\"momentarycen vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#c0392b\"> \n    Motores<br/><i class=\"fa fa-power-off\" aria-hidden=\"true\"></i>\n</md-button>\n</center>\n</div>\n\n<script>\n(function($scope) {\n$('.momentarycen').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentarycen').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    //$scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":230,"y":400,"wires":[["e267b4ea.5e4078"]]},{"id":"a0a4b056.f2c99","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"abajo iz","order":8,"width":"2","height":"1","format":" <div class=\"momentaryabiz vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#c0392b\"> \n    <i class=\"fa fa-reply fa-2x fa-flip-vertical\"></i>\n</md-button>\n</center>\n</div>\n\n<script>\n(function($scope) {\n$('.momentaryabiz').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryabiz').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":140,"wires":[["ac07c00d.54b0e","e982dd44.3aa8e","e54c41f4.4739"]]},{"id":"ca3cfbf8.ad2ce8","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"Atrás","order":9,"width":"2","height":"1","format":"<div class=\"momentaryat vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button \n   class=\"filled touched bigfont rounded\" \n   style=\"background-color:#c0392b\">\n   <i class=\"fa fa-arrow-down fa-2x\" aria-hidden=\"true\"></i>\n</md-button> \n</center>\n<script>\n(function($scope) {\n$('.momentaryat').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryat').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n</div>\n\n\n","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":230,"y":100,"wires":[["ac07c00d.54b0e","81fbf784.a31988","e54c41f4.4739"]]},{"id":"5d8c566e.cac518","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"arriba Iz","order":2,"width":"2","height":"1","format":"<div class=\"momentaryariz vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button class=\"filled touched bigfont rounded\" style=\"background-color:#c0392b\"> \n    <i class=\"fa fa-reply fa-2x\"></i>\n</md-button>\n</center>\n</div>\n<script>\n(function($scope) {\n$('.momentaryariz').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryariz').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":240,"y":260,"wires":[["e7972d49.1999a","aa6b81e0.33115","e54c41f4.4739"]]},{"id":"d14aa68e.2336f8","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"Formato botones","order":1,"width":"0","height":"0","format":"<style>\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n\n  \n</style>\n\n<script>\n$('.vibrate').on('touchstart mousedown', function() {\n  navigator.vibrate(100);\n});\n$('.vibrate').on('touchend mouseup', function() {\n  navigator.vibrate(100);\n});\n\n$('.vibrate').on('touchstart mousedown', function() {\n  navigator.vibrate(100);\n});\n\n$scope.action = function(controlName) {\n\n    var actioner = $scope[controlName];\n    if (!actioner) {\n      $scope[controlName] = actioner;\n    }\n actioner.on('touchstart mousedown', function(e) { \n\te.preventDefault();\n\t$scope.send({\"payload\": 1});\n\t});\n actioner.on('touchend mouseup', function(e) {\n\te.preventDefault();\n\t$scope.send({\"payload\": 1});\n\t});\n  }\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":430,"y":60,"wires":[[]]},{"id":"11b4e73b.d2ee29","type":"ui_template","z":"d4010628.de4e88","group":"d8e7c0bd.e7edb","name":"abajo der","order":10,"width":"2","height":"1","format":"<div class=\"momentaryabder vibrate filled bigfont rounded\" style=\"background-color:#c0392b\">\n<center>\n<md-button class=\"bigfont rounded\" style=\"background-color:#c0392b\"> \n    <i class=\"fa fa-reply fa-2x fa-rotate-180\"></i>\n</md-button> \n</center>\n</div>\n<script>\n(function($scope) {\n$('.momentaryabder').on('touchstart mousedown', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 1});\n});\n\n$('.momentaryabder').on('touchend mouseup', function(e) {\n    e.preventDefault(); //prevent default behavior\n    $scope.send({\"payload\": 0});\n});\n})(scope);\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":180,"wires":[["ac07c00d.54b0e","aa6b81e0.33115","e54c41f4.4739"]]},{"id":"759c1f6b.4ee12","type":"change","z":"d4010628.de4e88","name":"Motores On","rules":[{"t":"set","p":"motores","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":200,"wires":[["3e2272b4.b35f9e"]]},{"id":"e7972d49.1999a","type":"change","z":"d4010628.de4e88","name":"Adelante","rules":[{"t":"set","p":"reversa","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":400,"wires":[["2a2343f1.20400c"]]},{"id":"ac07c00d.54b0e","type":"change","z":"d4010628.de4e88","name":"Reversa","rules":[{"t":"set","p":"reversa","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":300,"wires":[["2a2343f1.20400c"]]},{"id":"e982dd44.3aa8e","type":"change","z":"d4010628.de4e88","name":"Right","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":100,"wires":[["4d5c9a93.8bb2b4","587ccee7.8b573"]]},{"id":"aa6b81e0.33115","type":"change","z":"d4010628.de4e88","name":"Left","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":140,"wires":[["4d5c9a93.8bb2b4","587ccee7.8b573"]]},{"id":"81fbf784.a31988","type":"change","z":"d4010628.de4e88","name":"Center","rules":[{"t":"set","p":"payload","pt":"msg","to":"5","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":180,"wires":[["4d5c9a93.8bb2b4","587ccee7.8b573"]]},{"id":"c6cb1dd0.e3731","type":"link out","z":"50896b44.fe0db4","name":"radar-volante","links":["3b540816.53f838"],"x":1475,"y":140,"wires":[]},{"id":"c732f915.be2848","type":"ui_slider","z":"6e574eb3.4d449","name":"","label":"Volante","tooltip":"","group":"5276cd55.81f1dc","order":7,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"0","max":"100","step":"0.5","x":620,"y":100,"wires":[["cf8c099f.64f968"]]},{"id":"c724b20b.c23c1","type":"pi-gpiod out","z":"6e574eb3.4d449","name":"Volante","host":"localhost","port":8888,"pin":"24","set":"","level":"0","out":"ser","sermin":"500","sermax":"2500","x":1020,"y":100,"wires":[]},{"id":"cf8c099f.64f968","type":"range","z":"6e574eb3.4d449","minin":"0","maxin":"100","minout":"65","maxout":"30","action":"clamp","round":true,"property":"payload","name":"","x":820,"y":100,"wires":[["c724b20b.c23c1"]]},{"id":"642ab0d9.9ff3a","type":"range","z":"6e574eb3.4d449","minin":"0","maxin":"9","minout":"0","maxout":"100","action":"scale","round":true,"property":"payload","name":"","x":460,"y":80,"wires":[["c732f915.be2848"]]},{"id":"2bd6e1dd.e8783e","type":"switch","z":"6e574eb3.4d449","name":"reversa?","property":"reversa","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":320,"y":100,"wires":[["642ab0d9.9ff3a"],["1a455722.b18a09"]]},{"id":"1a455722.b18a09","type":"range","z":"6e574eb3.4d449","minin":"0","maxin":"9","minout":"100","maxout":"0","action":"scale","round":true,"property":"payload","name":"","x":460,"y":120,"wires":[["c732f915.be2848"]]},{"id":"3b540816.53f838","type":"link in","z":"6e574eb3.4d449","name":"volante","links":["c6cb1dd0.e3731","4d5c9a93.8bb2b4"],"x":195,"y":100,"wires":[["2bd6e1dd.e8783e"]]},{"id":"4d5c9a93.8bb2b4","type":"link out","z":"d4010628.de4e88","name":"telefono-volante","links":["3b540816.53f838"],"x":775,"y":140,"wires":[]},{"id":"d6e21cb3.71a82","type":"switch","z":"50896b44.fe0db4","name":"auto?","property":"auto","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1250,"y":140,"wires":[["c6cb1dd0.e3731"]]},{"id":"8fee36b2.f70378","type":"ui_button","z":"8ba99e86.6869e","name":"","group":"bf30e811.8206f8","order":0,"width":0,"height":0,"passthru":false,"label":"Apagar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"sudo halt","payloadType":"str","topic":"","x":220,"y":860,"wires":[["6c51169f.ab8078"]]},{"id":"6c51169f.ab8078","type":"link out","z":"8ba99e86.6869e","name":"ui-apagar","links":["3aa36292.7674ce"],"x":635,"y":860,"wires":[]},{"id":"3aa36292.7674ce","type":"link in","z":"ffb2504d.e8d94","name":"sistema-apagar","links":["6c51169f.ab8078"],"x":55,"y":360,"wires":[["f267a421.891d58","46eee955.d07fd8"]]},{"id":"1267b836.7dc418","type":"ui_button","z":"8ba99e86.6869e","name":"","group":"bf30e811.8206f8","order":0,"width":0,"height":0,"passthru":false,"label":"Reiniciar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"sudo reboot","payloadType":"str","topic":"","x":220,"y":900,"wires":[["6c51169f.ab8078"]]},{"id":"35eb30f.96ae1d","type":"change","z":"d4010628.de4e88","name":"Motores Off","rules":[{"t":"set","p":"motores","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":240,"wires":[["2a2343f1.20400c"]]},{"id":"2a2343f1.20400c","type":"link out","z":"d4010628.de4e88","name":"telefono-motores","links":["d2457060.6ddad"],"x":1235,"y":420,"wires":[]},{"id":"7ba7936f.0cc30c","type":"switch","z":"50896b44.fe0db4","name":"auto?","property":"auto","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1170,"y":200,"wires":[["1ebd748.7289e8c"]]},{"id":"9b45b092.f7bbb","type":"ui_switch","z":"50896b44.fe0db4","name":"","label":"Autonomo","tooltip":"","group":"adab6c01.57e17","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":630,"y":580,"wires":[["c40463c5.a7e95","4e20dfcb.a8e8f"]]},{"id":"c40463c5.a7e95","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"auto","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":680,"wires":[["1ebd748.7289e8c","9b45b092.f7bbb"]]},{"id":"f4d17757.2c45a8","type":"inject","z":"50896b44.fe0db4","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":390,"y":740,"wires":[["3da8ee1b.be1cc2","5ff3f9b7.945248","c40463c5.a7e95"]]},{"id":"3da8ee1b.be1cc2","type":"ui_switch","z":"50896b44.fe0db4","name":"","label":"Radar","tooltip":"","group":"5276cd55.81f1dc","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":650,"y":740,"wires":[["b92176e0.f7f4b8","e8017910.74dc08"]]},{"id":"b92176e0.f7f4b8","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"radar","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":840,"wires":[["3da8ee1b.be1cc2"]]},{"id":"5ff3f9b7.945248","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"motores","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":880,"wires":[[]]},{"id":"4e20dfcb.a8e8f","type":"switch","z":"50896b44.fe0db4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":850,"y":580,"wires":[["e8017910.74dc08","b92176e0.f7f4b8"]]},{"id":"e8017910.74dc08","type":"switch","z":"50896b44.fe0db4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":760,"wires":[["c40463c5.a7e95","b92176e0.f7f4b8"]]},{"id":"3e2272b4.b35f9e","type":"change","z":"d4010628.de4e88","name":"Control temporal","rules":[{"t":"set","p":"temporal","pt":"global","to":"auto","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":200,"wires":[["ea06a338.8226c"]]},{"id":"e54c41f4.4739","type":"switch","z":"d4010628.de4e88","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":260,"wires":[["759c1f6b.4ee12"],["6609fcb9.618cd4"]]},{"id":"ea06a338.8226c","type":"change","z":"d4010628.de4e88","name":"auto off","rules":[{"t":"set","p":"auto","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1140,"y":200,"wires":[["2a2343f1.20400c"]]},{"id":"6609fcb9.618cd4","type":"change","z":"d4010628.de4e88","name":"Control temporal","rules":[{"t":"set","p":"auto","pt":"global","to":"temporal","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":260,"wires":[["ecbc0cc6.5674e"]]},{"id":"587ccee7.8b573","type":"change","z":"d4010628.de4e88","name":"","rules":[{"t":"set","p":"sector","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":100,"wires":[[]]},{"id":"b087b7b5.d318e8","type":"change","z":"d4010628.de4e88","name":"motores on","rules":[{"t":"set","p":"motores","pt":"global","to":"true","tot":"bool"},{"t":"set","p":"llave","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":360,"wires":[["e7972d49.1999a"]]},{"id":"e267b4ea.5e4078","type":"switch","z":"d4010628.de4e88","name":"","property":"motores","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":400,"wires":[["b087b7b5.d318e8"],["599f2a02.beb7a4"]]},{"id":"599f2a02.beb7a4","type":"change","z":"d4010628.de4e88","name":"motores off","rules":[{"t":"set","p":"motores","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"llave","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"auto","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"radar","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":420,"wires":[["e7972d49.1999a","e5014e0.3042bb"]]},{"id":"20a3a825.238b08","type":"inject","z":"8d66ddb9.1d7e","name":"","topic":"","payload":"","payloadType":"str","repeat":"0.05","crontab":"","once":true,"onceDelay":"5","x":170,"y":140,"wires":[["fc19dc71.8c5cb"]]},{"id":"fc19dc71.8c5cb","type":"file in","z":"8d66ddb9.1d7e","name":"","filename":"/dev/shm/mjpeg/cam.jpg","format":"","chunk":false,"sendError":false,"encoding":"none","x":410,"y":140,"wires":[["2bb5828e.08f92e"]]},{"id":"f32a805f.2e0a5","type":"template","z":"8d66ddb9.1d7e","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<img width=\"320px\" height=\"240px\" src=\"data:image/jpg;base64,{{{payload}}}\">","output":"str","x":760,"y":140,"wires":[["8270f296.cec0b"]]},{"id":"24fd4858.772a68","type":"comment","z":"8d66ddb9.1d7e","name":"Es necesario activar esto: https://elinux.org/RPi-Cam-Web-Interface","info":"","x":740,"y":220,"wires":[]},{"id":"37ab39c1.c18916","type":"comment","z":"8d66ddb9.1d7e","name":"Regula el FPS pero causa delay","info":"","x":230,"y":220,"wires":[]},{"id":"5a84da94.4ac064","type":"ui_template","z":"8d66ddb9.1d7e","group":"d6ff8b79.b23718","name":"Video","order":0,"width":"6","height":"6","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1190,"y":140,"wires":[[]]},{"id":"2bb5828e.08f92e","type":"base64","z":"8d66ddb9.1d7e","name":"","action":"str","property":"payload","x":600,"y":140,"wires":[["f32a805f.2e0a5"]]},{"id":"78870613.f44628","type":"comment","z":"8d66ddb9.1d7e","name":"Habilitar y desplegar para empezar a correr la transmisión de video.","info":"","x":340,"y":60,"wires":[]},{"id":"542e8468.6fac7c","type":"file in","z":"8d66ddb9.1d7e","name":"","filename":"/home/pi/ventana.jpg","format":"","chunk":false,"sendError":false,"encoding":"none","x":400,"y":280,"wires":[["2bb5828e.08f92e"]]},{"id":"d14802c.0a307","type":"inject","z":"8d66ddb9.1d7e","name":"Tomar foto","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":360,"wires":[["1d23fd5c.4e7fc3"]]},{"id":"1d23fd5c.4e7fc3","type":"exec","z":"8d66ddb9.1d7e","command":"raspistill -rot 90 -o ventana.jpg","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":450,"y":360,"wires":[["324d7f74.26fdf","542e8468.6fac7c"],["324d7f74.26fdf"],["324d7f74.26fdf"]]},{"id":"f7519c52.cad17","type":"inject","z":"6e574eb3.4d449","name":"centro","topic":"","payload":"50","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":"10","x":470,"y":220,"wires":[["c724b20b.c23c1","c732f915.be2848"]]},{"id":"4041e317.26597c","type":"inject","z":"50896b44.fe0db4","name":"centro","topic":"","payload":"42.5","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":"10","x":410,"y":520,"wires":[["26399dea.e1c72a","328fa9c9.56fa86"]]},{"id":"51fe256.e7ffadc","type":"rpi-srf","z":"50896b44.fe0db4","name":"Atras","topic":"SRF","pulse":"0.06","pins":"31,29","x":384,"y":174,"wires":[["607bea91.453f34","465da72.f601c58"]]},{"id":"b8ecdede.9dd2a","type":"change","z":"50896b44.fe0db4","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"posAtr","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":160,"wires":[["465da72.f601c58"]]},{"id":"607bea91.453f34","type":"smooth","z":"50896b44.fe0db4","name":"","property":"payload","action":"mean","count":"3","round":"0","mult":"single","reduce":true,"x":534,"y":174,"wires":[["b8ecdede.9dd2a","465da72.f601c58"]]},{"id":"bfad3a2.acb9dc8","type":"ui_switch","z":"8ba99e86.6869e","name":"","label":"Invertir derecha","tooltip":"","group":"192caa48.1b50d6","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":520,"y":1060,"wires":[["2b475b8e.24ecd4"]]},{"id":"eeb8fdf2.860ab","type":"ui_switch","z":"8ba99e86.6869e","name":"","label":"Invertir izquierda","tooltip":"","group":"192caa48.1b50d6","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":530,"y":1120,"wires":[["aa43c1ce.643ef"]]},{"id":"2b475b8e.24ecd4","type":"change","z":"8ba99e86.6869e","name":"","rules":[{"t":"set","p":"invDer","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":1060,"wires":[[]]},{"id":"aa43c1ce.643ef","type":"change","z":"8ba99e86.6869e","name":"","rules":[{"t":"set","p":"invIzq","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":1120,"wires":[[]]},{"id":"63f56713.a60938","type":"switch","z":"4bb65ed0.821b1","name":"izquierda invertida?","property":"invIzq","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":635.0000038146973,"y":165.00000762939453,"wires":[["ce85ac1a.5195b"],["3963a3ef.28a084"]]},{"id":"6403a4c4.cce28c","type":"switch","z":"4bb65ed0.821b1","name":"izquierda invertida?","property":"invIzq","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":615.0000038146973,"y":325.00000762939453,"wires":[["3963a3ef.28a084"],["ce85ac1a.5195b"]]},{"id":"2d320a0a.bb30c6","type":"inject","z":"8ba99e86.6869e","name":"","topic":"","payload":"invDer","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":290,"y":1060,"wires":[["bfad3a2.acb9dc8"]]},{"id":"ed0449cc.34d828","type":"inject","z":"8ba99e86.6869e","name":"","topic":"","payload":"invIzq","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":290,"y":1120,"wires":[["eeb8fdf2.860ab"]]},{"id":"ab82ec5a.970cd","type":"switch","z":"4bb65ed0.821b1","name":"derecha invertida?","property":"invDer","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":595.0000038146973,"y":725.0000076293945,"wires":[["d66fa798.05bba8"],["fd9ba81d.166b7"]]},{"id":"b897b495.593c08","type":"switch","z":"4bb65ed0.821b1","name":"derecha invertida?","property":"invDer","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":595.0000038146973,"y":845.0000076293945,"wires":[["fd9ba81d.166b7"],["d66fa798.05bba8"]]},{"id":"da930741.a89078","type":"delay","z":"50896b44.fe0db4","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":990,"y":300,"wires":[["22cfa0d8.4ecd5"]]},{"id":"ecbc0cc6.5674e","type":"switch","z":"d4010628.de4e88","name":"","property":"llave","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":260,"wires":[["35eb30f.96ae1d"],["2a2343f1.20400c","81fbf784.a31988"]]},{"id":"465da72.f601c58","type":"debug","z":"50896b44.fe0db4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":80,"wires":[]},{"id":"324d7f74.26fdf","type":"debug","z":"8d66ddb9.1d7e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":740,"y":360,"wires":[]},{"id":"f9595c14.8abd5","type":"exec","z":"8d66ddb9.1d7e","command":"raspivid -rot 90 -o vid.h264","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":440,"y":440,"wires":[[],[],[]]},{"id":"2e0e4985.ef58d6","type":"inject","z":"8d66ddb9.1d7e","name":"Tomar video","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":440,"wires":[["f9595c14.8abd5"]]},{"id":"e5014e0.3042bb","type":"link out","z":"d4010628.de4e88","name":"telefono-auto-off","links":["86d2629c.66825"],"x":695,"y":480,"wires":[]},{"id":"86d2629c.66825","type":"link in","z":"50896b44.fe0db4","name":"radar-auto","links":["e5014e0.3042bb"],"x":380,"y":680,"wires":[["c40463c5.a7e95"]]},{"id":"c57c18f1.12aaa8","type":"delay","z":"50896b44.fe0db4","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"3","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1070,"y":260,"wires":[["561dfd0a.3d3a84"]]},{"id":"e9e2b82f.889b28","type":"delay","z":"50896b44.fe0db4","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"3","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":730,"y":480,"wires":[["328fa9c9.56fa86"]]},{"id":"8270f296.cec0b","type":"delay","z":"8d66ddb9.1d7e","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"10","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":980,"y":140,"wires":[["5a84da94.4ac064"]]}]